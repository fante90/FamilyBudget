(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{p9XQ:function(t,l,e){"use strict";e.r(l);var n=e("8Y7J");class a{}var i=e("pMnS"),o=e("UMKc"),r=e("MKJQ"),u=e("sZkV"),s=e("hrZj"),c=e("aILq"),h=e("qyxE"),d=e("Witw"),b=e("bBk2"),p=e("A1CT"),g=e("MO+k");class f{constructor(t,l,e){this.uiService=t,this.appDBService=l,this.utilityService=e,this.chartFilterModel={fromDate:null,toDate:null,dateRange:"YEAR"},this.chartRef=null}refreshChart(t=null){const l={entity:h.a.entityName,date:{$gte:this.utilityService.dateToISO(this.chartFilterModel.fromDate),$lte:this.utilityService.dateToISO(this.chartFilterModel.toDate)}};h.a.getEntries(this.appDBService,!1,null,l).then(l=>{const e=l;let n=[];if("YEAR"==this.chartFilterModel.dateRange)n=["Ge","Fe","Ma","Ap","Ma","Gi","Lu","Ag","Se","Ot","No","Di"];else if("MONTH"==this.chartFilterModel.dateRange)for(let t=0;t<new Date(this.chartFilterModel.toDate).getDate();t++)n.push(""+(t+1));else n=["Lu","Ma","Me","Gi","Ve","Sa","Do"];let a=[],i=[];e.forEach(t=>{if(i.indexOf(t.id_category)<0){let l={label:t.category.description,backgroundColor:t.category.color,data:[]};n.forEach(()=>{l.data.push(0)}),a.push(l),i.push(t.id_category)}let l=i.indexOf(t.id_category),e="P"===t.category.type?1:-1;if("YEAR"==this.chartFilterModel.dateRange){const n=new Date(t.date).getMonth();a[l].data[n]+=t.value*e}else if("MONTH"==this.chartFilterModel.dateRange){const n=new Date(t.date).getDate();a[l].data[n]+=t.value*e}else{let n=new Date(t.date).getDay()-1;n<0&&(n=6),a[l].data[n]+=t.value*e}}),this.chartRef&&this.chartRef.destroy(),this.chartRef=new g.Chart(this.statsChart.nativeElement,{type:"bar",data:{labels:n,datasets:a},options:{legend:{display:!1},tooltips:{mode:"index",intersect:!1},maintainAspectRatio:!1,responsive:!0,scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0,ticks:{display:!1}}]}}}),t&&t.target.complete()})}dateFilterChanged(t){this.chartFilterModel.fromDate=t.start.toISOString(),this.chartFilterModel.toDate=t.end.toISOString(),this.chartFilterModel.dateRange=t.range,this.refreshChart()}}var M=n.nb({encapsulation:0,styles:[["ion-content[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background:translucent}"]],data:{}});function y(t){return n.Kb(0,[n.Gb(671088640,1,{statsChart:0}),(t()(),n.pb(1,0,null,null,9,"div",[],null,null,null,null,null)),(t()(),n.pb(2,0,null,null,6,"ion-list",[["mode","ios"]],null,null,null,r.rb,r.x)),n.ob(3,49152,null,0,u.O,[n.h,n.k,n.x],{mode:[0,"mode"]},null),(t()(),n.pb(4,0,null,0,4,"ion-list-header",[],null,null,null,r.qb,r.y)),n.ob(5,49152,null,0,u.P,[n.h,n.k,n.x],null,null),(t()(),n.pb(6,0,null,0,2,"ion-label",[["class","ion-no-margin"]],null,null,null,r.pb,r.w)),n.ob(7,49152,null,0,u.N,[n.h,n.k,n.x],null,null),(t()(),n.Ib(-1,0,["Statistiche"])),(t()(),n.pb(9,0,null,null,1,"app-fb-date-filter-toolbar",[],null,[[null,"changed"]],(function(t,l,e){var n=!0;return"changed"===l&&(n=!1!==t.component.dateFilterChanged(e)&&n),n}),s.b,s.a)),n.ob(10,114688,null,0,c.a,[u.Jb,n.h,n.x],null,{changed:"changed"}),(t()(),n.pb(11,0,null,null,2,"ion-content",[],null,null,null,r.cb,r.j)),n.ob(12,49152,null,0,u.u,[n.h,n.k,n.x],null,null),(t()(),n.pb(13,0,[[1,0],["statsChart",1]],0,0,"canvas",[],null,null,null,null,null))],(function(t,l){t(l,3,0,"ios"),t(l,10,0)}),null)}function v(t){return n.Kb(0,[(t()(),n.pb(0,0,null,null,1,"app-stats",[],null,null,null,y,M)),n.ob(1,49152,null,0,f,[d.a,b.a,p.a],null,null)],null,null)}var D=n.lb("app-stats",f,v,{},{},[]),S=e("SVse"),k=e("s7LF"),m=e("iInd"),F=e("0Rqu");e.d(l,"StatsPageModuleNgFactory",(function(){return x}));var x=n.mb(a,[],(function(t){return n.yb([n.zb(512,n.j,n.X,[[8,[i.a,o.a,D]],[3,n.j],n.v]),n.zb(4608,S.m,S.l,[n.s,[2,S.x]]),n.zb(4608,u.c,u.c,[n.x,n.g]),n.zb(4608,u.Eb,u.Eb,[u.c,n.j,n.p]),n.zb(4608,u.Jb,u.Jb,[u.c,n.j,n.p]),n.zb(4608,k.l,k.l,[]),n.zb(1073742336,S.b,S.b,[]),n.zb(1073742336,u.Bb,u.Bb,[]),n.zb(1073742336,k.k,k.k,[]),n.zb(1073742336,k.b,k.b,[]),n.zb(1073742336,m.o,m.o,[[2,m.t],[2,m.m]]),n.zb(1073742336,F.a,F.a,[]),n.zb(1073742336,a,a,[]),n.zb(1024,m.k,(function(){return[[{path:"",component:f}]]}),[])])}))}}]);