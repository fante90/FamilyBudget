(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{p9XQ:function(t,e,l){"use strict";l.r(e);var n=l("8Y7J");class a{}var o=l("pMnS"),i=l("UMKc"),s=l("MKJQ"),r=l("sZkV"),u=l("hrZj"),d=l("aILq"),c=l("qyxE"),h=l("Witw"),p=l("bBk2"),b=l("A1CT"),y=l("MO+k");class g{constructor(t,e,l){this.uiService=t,this.appDBService=e,this.utilityService=l,this.chartFilterModel={fromDate:null,toDate:null,dateRange:"YEAR"},this.chartRefOut=null,this.chartRefIn=null,this.chartSliderOpts={initialSlide:0,speed:400}}refreshChart(t=null){const e={entity:c.a.entityName,date:{$gte:this.utilityService.dateToISO(this.chartFilterModel.fromDate),$lte:this.utilityService.dateToISO(this.chartFilterModel.toDate)}};c.a.getEntries(this.appDBService,!1,null,e).then(e=>{const l=e;let n=[];if("YEAR"===this.chartFilterModel.dateRange)n=["Ge","Fe","Ma","Ap","Ma","Gi","Lu","Ag","Se","Ot","No","Di"];else if("MONTH"===this.chartFilterModel.dateRange)for(let t=0;t<new Date(this.chartFilterModel.toDate).getDate();t++)n.push(""+(t+1));else n=["Lu","Ma","Me","Gi","Ve","Sa","Do"];let a=[],o=[],i=[],s=[];l.forEach(t=>{if(s.indexOf(t.id_category)<0&&i.indexOf(t.id_category)<0){let e={label:t.category.description,backgroundColor:t.category.color,data:[]};n.forEach(()=>{e.data.push(0)}),"P"===t.category.type?(o.push(e),s.push(t.id_category)):(a.push(e),i.push(t.id_category))}let e=0;if(e="P"===t.category.type?s.indexOf(t.id_category):i.indexOf(t.id_category),"YEAR"===this.chartFilterModel.dateRange){const l=new Date(t.date).getMonth();"P"===t.category.type?o[e].data[l]+=t.value:a[e].data[l]+=t.value}else if("MONTH"===this.chartFilterModel.dateRange){const l=new Date(t.date).getDate();"P"===t.category.type?o[e].data[l]+=t.value:a[e].data[l]+=t.value}else{let l=new Date(t.date).getDay()-1;l<0&&(l=6),"P"===t.category.type?o[e].data[l]+=t.value:a[e].data[l]+=t.value}}),this.chartRefIn&&this.chartRefIn.destroy(),this.chartRefOut&&this.chartRefOut.destroy(),this.chartRefIn=new y.Chart(this.statsInChart.nativeElement,{type:"bar",data:{labels:n,datasets:o},options:{legend:{display:!1},tooltips:{enabled:!1,mode:"index",position:"nearest",custom:this.customTooltips},maintainAspectRatio:!1,responsive:!0,scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0,ticks:{display:!1}}]}}}),this.chartRefOut=new y.Chart(this.statsOutChart.nativeElement,{type:"bar",data:{labels:n,datasets:a},options:{legend:{display:!1},tooltips:{enabled:!1,mode:"index",position:"nearest",custom:this.customTooltips},maintainAspectRatio:!1,responsive:!0,scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0,ticks:{display:!1}}]}}}),t&&t.target.complete()})}dateFilterChanged(t){this.chartFilterModel.fromDate=t.start.toISOString(),this.chartFilterModel.toDate=t.end.toISOString(),this.chartFilterModel.dateRange=t.range,this.refreshChart()}slideNext(){}slidePrev(){}customTooltips(t){let e=document.getElementById("chartjs-tooltip");if(e||(e=document.createElement("div"),e.id="chartjs-tooltip",e.innerHTML="<table></table>",document.getElementById("ionContent").appendChild(e),e=document.getElementById("chartjs-tooltip")),0!==t.opacity){if(e.classList.remove("above","below","no-transform"),e.classList.add(t.yAlign?t.yAlign:"no-transform"),t.body){let l=t.title||[],n=t.body.map((function(t){return t.lines})),a="<thead>";l.forEach(t=>{a+="<tr><th>"+t+"</th></tr>"}),a+="</thead><tbody>",n.forEach((e,l)=>{let n=t.labelColors[l],o="background:"+n.backgroundColor;o+="; border-color:"+n.borderColor,o+="; border-width: 2px";let i='<span class="chartjs-tooltip-key" style="'+o+'"></span>';const s=e[0].split(":");a+="<tr><td>"+i+s[0]+": "+parseFloat(s[1].trim()).toFixed(2)+"&euro;</td></tr>"}),a+="</tbody>",e.querySelector("table").innerHTML=a}e.style.opacity="1",e.style.left=t.x+"px",e.style.top=t.y+"px",e.style.fontFamily=t._bodyFontFamily,e.style.fontSize=t.bodyFontSize+"px",e.style.fontStyle=t._bodyFontStyle,e.style.padding=t.yPadding+"px "+t.xPadding+"px"}else e.style.opacity=0}}var f=n.nb({encapsulation:0,styles:[["ion-content[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background:translucent}ion-slides[_ngcontent-%COMP%]{height:100%}"]],data:{}});function m(t){return n.Kb(0,[n.Gb(671088640,1,{statsOutChart:0}),n.Gb(671088640,2,{statsInChart:0}),(t()(),n.pb(2,0,null,null,9,"div",[],null,null,null,null,null)),(t()(),n.pb(3,0,null,null,6,"ion-list",[["mode","ios"]],null,null,null,s.rb,s.x)),n.ob(4,49152,null,0,r.O,[n.h,n.k,n.x],{mode:[0,"mode"]},null),(t()(),n.pb(5,0,null,0,4,"ion-list-header",[],null,null,null,s.qb,s.y)),n.ob(6,49152,null,0,r.P,[n.h,n.k,n.x],null,null),(t()(),n.pb(7,0,null,0,2,"ion-label",[["class","ion-no-margin"]],null,null,null,s.pb,s.w)),n.ob(8,49152,null,0,r.N,[n.h,n.k,n.x],null,null),(t()(),n.Ib(-1,0,["Statistiche"])),(t()(),n.pb(10,0,null,null,1,"app-fb-date-filter-toolbar",[],null,[[null,"changed"]],(function(t,e,l){var n=!0;return"changed"===e&&(n=!1!==t.component.dateFilterChanged(l)&&n),n}),u.b,u.a)),n.ob(11,114688,null,0,d.a,[r.Jb,n.h,n.x],null,{changed:"changed"}),(t()(),n.pb(12,0,null,null,9,"ion-content",[["id","ionContent"]],null,null,null,s.cb,s.j)),n.ob(13,49152,null,0,r.u,[n.h,n.k,n.x],null,null),(t()(),n.pb(14,0,null,0,7,"ion-slides",[["pager","false"]],null,[[null,"ionSlideNextEnd"],[null,"ionSlidePrevEnd"]],(function(t,e,l){var n=!0,a=t.component;return"ionSlideNextEnd"===e&&(n=!1!==a.slideNext()&&n),"ionSlidePrevEnd"===e&&(n=!1!==a.slidePrev()&&n),n}),s.Cb,s.J)),n.ob(15,49152,null,0,r.ob,[n.h,n.k,n.x],{options:[0,"options"],pager:[1,"pager"]},null),(t()(),n.pb(16,0,null,0,2,"ion-slide",[],null,null,null,s.Bb,s.I)),n.ob(17,49152,null,0,r.nb,[n.h,n.k,n.x],null,null),(t()(),n.pb(18,0,[[1,0],["statsOutChart",1]],0,0,"canvas",[],null,null,null,null,null)),(t()(),n.pb(19,0,null,0,2,"ion-slide",[],null,null,null,s.Bb,s.I)),n.ob(20,49152,null,0,r.nb,[n.h,n.k,n.x],null,null),(t()(),n.pb(21,0,[[2,0],["statsInChart",1]],0,0,"canvas",[],null,null,null,null,null))],(function(t,e){var l=e.component;t(e,4,0,"ios"),t(e,11,0),t(e,15,0,l.chartSliderOpts,"false")}),null)}function x(t){return n.Kb(0,[(t()(),n.pb(0,0,null,null,1,"app-stats",[],null,null,null,m,f)),n.ob(1,49152,null,0,g,[h.a,p.a,b.a],null,null)],null,null)}var v=n.lb("app-stats",g,x,{},{},[]),S=l("SVse"),M=l("s7LF"),k=l("iInd"),O=l("0Rqu");l.d(e,"StatsPageModuleNgFactory",(function(){return C}));var C=n.mb(a,[],(function(t){return n.yb([n.zb(512,n.j,n.X,[[8,[o.a,i.a,v]],[3,n.j],n.v]),n.zb(4608,S.m,S.l,[n.s,[2,S.x]]),n.zb(4608,r.c,r.c,[n.x,n.g]),n.zb(4608,r.Eb,r.Eb,[r.c,n.j,n.p]),n.zb(4608,r.Jb,r.Jb,[r.c,n.j,n.p]),n.zb(4608,M.l,M.l,[]),n.zb(1073742336,S.b,S.b,[]),n.zb(1073742336,r.Bb,r.Bb,[]),n.zb(1073742336,M.k,M.k,[]),n.zb(1073742336,M.b,M.b,[]),n.zb(1073742336,k.o,k.o,[[2,k.t],[2,k.m]]),n.zb(1073742336,O.a,O.a,[]),n.zb(1073742336,a,a,[]),n.zb(1024,k.k,(function(){return[[{path:"",component:g}]]}),[])])}))}}]);